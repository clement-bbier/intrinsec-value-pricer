[pytest]
# =============================================================================
# PYTEST CONFIGURATION â€” Professional Test Suite
# =============================================================================

# 1. Test Discovery
testpaths = tests
python_files = test_*.py

# 2. Import Management (Ensures src/app/infra are discoverable)
pythonpath = .

# 3. Custom Markers Definition
markers =
    unit: Pure unit tests (isolated logic, no I/O)
    integration: Integration tests between internal components
    e2e: End-to-End workflow validation
    contracts: API and Data contract tests (invariants)
    freshness: Data freshness guards (macro-economic constants, spread tables)
    slow: Long-running tests (Network, Monte Carlo simulations)
    valuation: Tests specific to valuation strategies

# 4. Execution Options
# -v : Verbose output
# --strict-markers : Errors out if an unregistered marker is used
# --tb=short : Concise tracebacks for better readability
addopts = -v --strict-markers --tb=short

# 5. Warning Suppression (Cleanup for Phase 3)
filterwarnings =
    # Suppress third-party library deprecation noise (Google/Protobuf/yfinance)
    ignore:Type google._upb._message.MessageMapContainer uses PyType_Spec:DeprecationWarning
    ignore:Type google._upb._message.ScalarMapContainer uses PyType_Spec:DeprecationWarning
    ignore::DeprecationWarning:google.*
    ignore:Default value <property object.* is not JSON serializable:pydantic.json_schema.PydanticJsonSchemaWarning

# =============================================================================
# USEFUL COMMANDS:
# pytest tests/                                     # Run all tests
# pytest tests/unit/                                # Unit tests only
# pytest tests/ -m "not slow"                       # Exclude slow tests
# pytest tests/ --cov=src --cov=app --cov=infra     # Run with coverage report
# =============================================================================