[pytest]
# =============================================================================
# CONFIGURATION PYTEST — Suite de Tests Exhaustive
# =============================================================================

# 1. Localisation des tests
testpaths = tests
python_files = test_*.py

# 2. Gestion des imports (Crucial pour que pytest trouve les dossiers core/infra)
pythonpath = .

# 3. Définition des Markers (Pour filtrer l'exécution)
markers =
    unit: Tests unitaires purs (rapides, sans I/O)
    integration: Tests d'intégration entre composants
    e2e: Tests End-to-End du workflow complet
    contracts: Tests de contrats API (ne doivent pas changer)
    slow: Tests lents (réseau, Monte Carlo, etc.)
    valuation: Tests spécifiques aux stratégies de valorisation

# 4. Options par défaut
# -v : Verbeux (affiche le nom des tests)
# --strict-markers : Erreur si on utilise un marker non défini
# --tb=short : Tracebacks courts pour lisibilité
addopts = -v --strict-markers --tb=short

# 5. Ignorer les warnings de dépréciation des libs tierces
filterwarnings =
    ignore::DeprecationWarning:google.*:

# =============================================================================
# COMMANDES UTILES :
# pytest tests/                           # Tous les tests
# pytest tests/unit/                      # Unitaires uniquement
# pytest tests/contracts/                 # Contrats uniquement
# pytest tests/ -m "not slow"             # Exclure tests lents
# pytest tests/ -m "contracts or unit"    # Contrats + Unitaires
# pytest tests/ --cov=core --cov=app      # Avec couverture
# =============================================================================