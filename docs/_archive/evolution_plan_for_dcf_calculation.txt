# Evolution Plan — Intrinsic Value Pricer (DCF)

## Overview

This document outlines the evolution of the Intrinsic Value Pricer app from a simple DCF engine to an institutional-grade valuation framework. It covers financial theory, formulas, required data, technical architecture, sector-specific limitations, and methodology selection rules.

---

# 0. Current Version (V1 — Basic DCF)

### What V1 Implements

* FCFF = CFO − Capex
* Constant FCFF growth rate (single-phase DCF)
* CAPM for Re and simplified WACC
* Gordon–Shapiro perpetual terminal value
* Equity Value = EV − Debt + Cash
* Intrinsic Value per share
* Data pulled from Yahoo Finance (`yfinance`)
* Streamlit UI (interactive)
* Modular `core/`, `infra/`, `app/` architecture

---

# 1. Evolution Funnel (from simple → advanced)

| Level | Name              | Features                                   | Code Complexity | Data Complexity |
| ----- | ----------------- | ------------------------------------------ | --------------- | --------------- |
| V1    | Basic DCF         | FCFF simple (CFO − Capex)                  | ★☆☆             | ★☆☆             |
| PRO1  | 3-Statement Light | EBIT→NOPAT, D&A, ΔNWC, FCFF pro, scenarios | ★★☆             | ★★☆             |
| PRO2  | IB / M&A Level    | Segments, TV multiples, leverage structure | ★★★             | ★★★             |
| EXP   | HF / PE Level     | Monte Carlo, unlevered betas, LBO, APIs    | ★★★★            | ★★★★            |

---

# 2. V1 Details — Formulas and Data

## 2.1 FCFF Basic

[
FCFF = CFO - Capex
]

## 2.2 WACC

[
R_e = R_f + \beta \times MRP
]

[
WACC = \frac{E}{E+D} R_e + \frac{D}{E+D} R_d (1-T)
]

## 2.3 Terminal Value

[
TV = \frac{FCF_{n+1}}{WACC - g}
]

## 2.4 Data Required (Yahoo Finance)

* Current price
* Shares outstanding
* Beta
* Total debt
* Cash & cash equivalents
* Cash flow from operations
* Capital expenditure
* Currency
* Historical prices

---

# 3. PRO LEVEL 1 — “3-Statement Light” (Method 2)

This level introduces a more professional FCFF construction based on three financial statements. It is the first method used in real M&A / equity research practice.

## 3.1 Professional FCFF Formula

[
NOPAT = EBIT \times (1 - tax)
]

[
FCFF = NOPAT + D&A - Capex - \Delta NWC
]

This is a **true operating cash flow** measure and corrects many limitations of the basic CFO − Capex approach.

## 3.2 Required Additional Data

From **income statement**:

* Revenue
* Operating Income (EBIT)
* Depreciation & Amortization

From **balance sheet**:

* Accounts Receivable (AR)
* Inventory
* Accounts Payable (AP)

From **cash flow**:

* Capex

## 3.3 ΔNWC Calculation

[
NWC = AR + Inventory - AP
]

[
\Delta NWC = NWC_t - NWC_{t-1}
]

Data issues (missing AR, AP, or Inventory) must trigger warnings and fallback rules (e.g., assume missing components = 0, or ΔNWC = 0 if insufficient history).

## 3.4 FCFF₀ Construction (Recommended)

Use a **3-year rolling average**:

[
FCFF_0 = \frac{FCFF_{t} + FCFF_{t-1} + FCFF_{t-2}}{3}
]

This stabilizes noise and corrects one-offs.

## 3.5 Scenarios (Base / Bull / Bear)

Vary:

* Growth rate (g)
* WACC
* Terminal growth (g∞)

Useful for sensitivity and Monte-Carlo extensions later.

## 3.6 Sector Limitations

This method is **not** suitable for:

* Banks
* Insurance
* REITs
* ETFs / indices
* Crypto

For these, alternative models should be used (see Method 4).

---

# 4. PRO LEVEL 2 — Investment Banking / M&A Models (Method 3)

This level covers models used in professional banking, equity research and valuation fairness opinions.

## 4.1 Multi-Segment Modeling

Break down:

* Revenues by business line
* Margin profiles per segment
* Capex per segment
* NWC per segment

⚠ Segment data often missing from Yahoo Finance → requires PDF/XBRL extraction or paid APIs.

## 4.2 Terminal Value Using Multiples

[
TV = EBITDA_{final} \times (EV/EBITDA_{multiple})
]

Multiples may come from:

* Comparable companies
* Transaction comps

## 4.3 Target Capital Structure & Beta Unlevering

[
\beta_u = \frac{\beta}{1 + (1 - T) D/E}
]

[
\beta_r = \beta_u \times (1 + (1 - T) D_{target}/E_{target})
]

This allows valuation under a **target leverage**.

## 4.4 When this Method is Relevant

* Conglomerates
* Industrial companies
* Media / telecom
* Any firm where segment economics differ significantly

---

# 5. EXPERT LEVEL — Hedge Funds / Private Equity (Method 4)

This is the institutional-grade level.

## 5.1 Monte Carlo Simulation

Simulate:

* WACC
* FCFF growth
* Operating margins
* Terminal growth

Outputs:

* Probability distribution of intrinsic value
* Sensitivity to assumptions
* Probability IV > Market Price

## 5.2 Peer-Based Beta Construction

Unlever → average → relever beta:

* More robust than using a single company beta
* Required for leveraged transactions (LBOs)

## 5.3 Integration with Real Economic APIs

Use:

* FRED (macro)
* ECB yield curves
* Risk-free-rate APIs
* Corporate bond spreads
* Commodity prices for energy companies

## 5.4 S-Curve Revenue Forecasting

Logistic growth curve for:

* Tech
* SaaS
* Early-stage high-growth businesses

## 5.5 LBO Modeling (IRR-driven)

Project:

* Leverage levels
* Debt amortization schedule
* Exit multiple
* Equity IRR

---

# 6. Practical Data Limitations

## What Yahoo Provides Easily

* CFO
* Capex
* EBIT
* Revenue
* Depreciation & Amortization
* Some NWC line items
* Debt / cash / beta

## What Is Hard or Incomplete

* Segment breakdown
* Capex by segment
* Leases (IFRS 16)
* SBC (Stock-based compensation)
* Non-operating adjustments
* Detailed tax reconciliation

## Requires Multimodal Extraction

* Annual reports (PDF)
* 10-K / 20-F (HTML/XBRL)
* Peer-set financial datasets
* Alternative data sources

---

# 7. Architecture for Future Expansion

## core/

* `run_dcf_basic()`
* `run_dcf_fundamental()` (Method 2)
* `run_dcf_multiples()` (Method 3)
* `run_dcf_simulation()` (Method 4)
* `ValuationService` + registry (dispatch by mode)

## infra/

* `YahooProviderBasic`
* `YahooProviderFundamental`
* `YahooProviderExtended` (for multi-statement historical data)
* `MacroProvider` (risk-free rates per currency)
* PDF/XBRL parsers (future)

## app/

* Minimal UI
* Methodology tabs
* KPI display
* Scenario controls
* Error & recommendation messages (sector-aware)

---

# 8. Sector Rules & Method Recommendation (Future)

Once all four methods are implemented, the app should:

### Detect company type via Yahoo metadata:

* `sector`
* `industry`
* `quoteType`
* `currency`

### Recommend the appropriate valuation method:

| Sector             | Recommended Method                 |
| ------------------ | ---------------------------------- |
| Tech / SaaS        | Method 2 (+ simulation)            |
| Industrial         | Method 2 or 3                      |
| Energy / Cyclicals | Method 2 + scenario analysis       |
| Banks              | Method 4 (ROE-based or simulation) |
| Insurance          | Method 4                           |
| REIT               | Method 3 (AFFO multiples)          |
| ETFs / Indices     | No DCF (warning)                   |
| Crypto             | Not applicable (simulation only)   |

### Risk-Free Rate Logic

Risk-free rate should depend on:

* **Reporting currency** (USD, EUR, GBP…)
* Not strictly on region of listing
* Many multinationals are USD-based even if listed abroad
* MacroProvider must auto-select correct yield curve

This avoids mismatched WACC calculations.

---

# 9. Final Roadmap

### Phase 1 — Complete V1

* Basic DCF engine
* UI + KPIs + chart
* Yahoo basic provider

### Phase 2 — Implement Method 2

* NOPAT-based FCFF
* ΔNWC
* 3-year smoothing
* Scenarios
* Data quality flags

### Phase 3 — Implement Method 3

* Multiples
* Target leverage
* Beta unlevering
* Sector adjustments

### Phase 4 — Implement Method 4

* Monte Carlo
* Sector-specific models (banks, REITs, insurers)
* Peer beta engine
* Real macro APIs
* LBO toolkit

### Phase 5 — Sector Logic + UX

* Ticker classification
* Recommended method display
* Warning banners
* Automatic fallback to suitable models

---

# Conclusion

The current architecture (core/infra/app separation + registry engine + Streamlit UI) is ideal for scaling the Intrinsic Value Pricer from a simple educational tool to a professional-grade, multi-method valuation framework.

The evolution path is clear, modular, and consistent with real valuation practice used in corporate finance, investment banking, hedge funds, and private equity.